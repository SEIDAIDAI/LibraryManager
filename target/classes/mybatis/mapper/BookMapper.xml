<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- mapper标签要指定namespace属性，不然会报错，可看做包名 -->

<mapper namespace="com.ibm6.mapper.BookMapper">
	<resultMap type="com.ibm6.bean.Book" id="bookResultMap">
		<result property="bookId" column="book_id" />
		<result property="storeDate" column="store_date" />
		<result property="leftAmount" column="left_amount" />
		<result property="uploadAmount" column="upload_amount" />
		<result property="downloadAmount" column="download_amount" />
	</resultMap>
	
	<select id="getCount" resultType="int">
		select 	count(*) from book
	</select>
	
	<select id="selectAllNation" resultType="com.ibm6.model.BookNation">
		select * from nation
	</select>

	<select id="selectByCondition" resultType="com.ibm6.bean.Book">
		select 
		book_id,	
		book_name, 
		nation, 
		type,
		length,
		theme,
		store_date,
		left_amount,
		upload_amount,
		download_amount,
		author,
		summary 
		from Book
		<where>
			<if test="nation != null">
				nation=#{nation}
			</if>
			<if test="type != null">
				type=#{type}
			</if>
			<if test="length != null">
				length=#{length}
			</if>
			<if test="theme != null">
				theme=#{theme}
			</if>
		</where>
	</select>

	<select id="getById" resultType="com.ibm6.bean.Book">
		select 
		book_id,	
		book_name, 
		nation, 
		type,
		length,
		theme,
		store_date,
		left_amount,
		upload_amount,
		download_amount,
		author,
		summary
		from Book
		<where>
			<if test="bookId != null">
				book_id=#{bookId}
			</if>
		</where>
	</select>

	<select id="selectByKeyword" resultType="com.ibm6.bean.Book">
		select 
		book_id,	
		book_name, 
		nation, 
		type,
		length,
		theme,
		store_date,
		left_amount,
		upload_amount,
		download_amount,
		author,
		summary 
		from Book
		<where>
			<if test="bookName != null">
				book_name=#{bookName} or author=#{bookName}
			</if>
		</where>
	</select>

	<select id="selectByPage" resultType="com.ibm6.bean.Book">
		select 
		book_id,	
		book_name, 
		nation, 
		type,
		length,
		theme,
		store_date,
		left_amount,
		upload_amount,
		download_amount,
		author,
		summary 
		from Book limit
		#{index}, 5
	</select>

	<update id="updateById">
		update book
		set book_name = #{bookName},
		nation = #{nation},
		type = #{type},
		length = #{length},
		theme = #{theme},
		store_date = #{storeDate},
		left_amount = #{leftAmount},
		upload_amount = #{uploadAmount},
		download_amount = #{downloadAmount}
		where book_id = #{bookId}
	</update>

	<insert id="saveNewBook">
		insert into book(
		book_name, 
		nation, 
		type,
		length,
		theme,
		store_date,
		left_amount,
		upload_amount,
		download_amount,
		author,
		summary
		)
		values(
		#{bookName},
		#{nation},
		#{type},
		#{length},
		#{theme},
		#{storeDate},
		#{leftAmount},
		#{uploadAmount},
		#{downloadAmount},
		#{author},
		#{summary}
		)
	</insert>

	<delete id="deleteById">
		delete from book
		where book_id = #{bookId}
	</delete>
	
	<select id="selectAllType" resultType="com.ibm6.model.BookType">
		select * from type
	</select>
	
	<select id="selectAllTheme" resultType="com.ibm6.model.BookTheme">
		select * from theme where type_id=#{bookType}
	</select>
	
	<select id="selectAllLength" resultType="com.ibm6.model.BookLength">
		select * from length
	</select>
</mapper>



